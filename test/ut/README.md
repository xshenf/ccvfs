# CCVFS Unit Test Suite

è¿™æ˜¯ CCVFS (Compressed and Cached Virtual File System) é¡¹ç›®çš„å®Œæ•´å•å…ƒæµ‹è¯•å¥—ä»¶ã€‚

## æ¦‚è¿°

å•å…ƒæµ‹è¯•å¥—ä»¶åŒ…å«ä»¥ä¸‹æµ‹è¯•æ¨¡å—ï¼š

### 1. æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• (CCVFS_Core)
- VFS åˆ›å»ºå’Œé”€æ¯
- å‚æ•°éªŒè¯
- åŸºæœ¬æ•°æ®åº“æ“ä½œ
- é”™è¯¯å¤„ç†
- å¤š VFS å®ä¾‹ç®¡ç†

### 2. å‹ç¼©åŠŸèƒ½æµ‹è¯• (Compression)
- åŸºæœ¬å‹ç¼©å’Œè§£å‹ç¼©
- ä¸åŒå‹ç¼©ç®—æ³• (zlib, lz4, rle)
- å„ç§é¡µé¢å¤§å°
- å‹ç¼©çº§åˆ«æµ‹è¯•
- ç»Ÿè®¡ä¿¡æ¯å’Œé”™è¯¯å¤„ç†

### 3. æ‰¹é‡å†™å…¥å™¨æµ‹è¯• (Batch_Writer)
- é…ç½®å’ŒåŸºæœ¬æ“ä½œ
- ç»Ÿè®¡ä¿¡æ¯å’Œåˆ·æ–°æ“ä½œ
- ä¸åŒé…ç½®ç»„åˆ
- æ€§èƒ½ç‰¹æ€§
- é”™è¯¯å¤„ç†

### 4. é›†æˆæµ‹è¯• (Integration)
- ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
- å®æ—¶å‹ç¼©ä¸æ‰¹é‡å†™å…¥å™¨
- æ··åˆè¯»å†™æ“ä½œ
- é”™è¯¯æ¢å¤å’Œä¸€è‡´æ€§
- è´Ÿè½½ä¸‹çš„æ€§èƒ½æµ‹è¯•

## æ„å»ºå’Œè¿è¡Œ

### æ„å»ºæµ‹è¯•

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
mkdir build && cd build
cmake ..
make unit_tests
```

### ä½¿ç”¨ CTest è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
ctest

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
ctest -R CoreTests           # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
ctest -R CompressionTests    # å‹ç¼©åŠŸèƒ½æµ‹è¯•
ctest -R BatchWriterTests    # æ‰¹é‡å†™å…¥å™¨æµ‹è¯•
ctest -R IntegrationTests    # é›†æˆæµ‹è¯•
ctest -R AllUnitTests        # æ‰€æœ‰å•å…ƒæµ‹è¯•

# è¿è¡Œå¸¦æ ‡ç­¾çš„æµ‹è¯•
ctest -L unit                # æ‰€æœ‰å•å…ƒæµ‹è¯•
ctest -L core                # æ ¸å¿ƒæµ‹è¯•
ctest -L compression         # å‹ç¼©æµ‹è¯•
ctest -L batch               # æ‰¹é‡å†™å…¥å™¨æµ‹è¯•
ctest -L integration         # é›†æˆæµ‹è¯•

# è¯¦ç»†è¾“å‡º
ctest -V                     # è¯¦ç»†è¾“å‡º
ctest --output-on-failure    # å¤±è´¥æ—¶æ˜¾ç¤ºè¾“å‡º
ctest -VV                    # è¶…è¯¦ç»†è¾“å‡º

# å¹¶è¡Œè¿è¡Œæµ‹è¯•
ctest -j4                    # ä½¿ç”¨4ä¸ªå¹¶è¡Œä½œä¸š

# è¿è¡Œç‰¹å®šæµ‹è¯•å¹¶æ˜¾ç¤ºè¾“å‡º
ctest -R CoreTests -V
```

### ç›´æ¥è¿è¡Œæµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•å¥—ä»¶
./test/ut/unit_tests

# è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶
./test/ut/unit_tests CCVFS_Core
./test/ut/unit_tests Compression
./test/ut/unit_tests Batch_Writer
./test/ut/unit_tests Integration

# æŸ¥çœ‹å¯ç”¨æµ‹è¯•å¥—ä»¶
./test/ut/unit_tests --list

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
./test/ut/unit_tests --help
```

## æµ‹è¯•æ¡†æ¶ç‰¹æ€§

### æ–­è¨€å®
- `TEST_ASSERT(condition, message)` - åŸºæœ¬æ–­è¨€
- `TEST_ASSERT_EQ(expected, actual, message)` - ç›¸ç­‰æ–­è¨€
- `TEST_ASSERT_STR_EQ(expected, actual, message)` - å­—ç¬¦ä¸²ç›¸ç­‰æ–­è¨€
- `TEST_ASSERT_NULL(ptr, message)` - ç©ºæŒ‡é’ˆæ–­è¨€
- `TEST_ASSERT_NOT_NULL(ptr, message)` - éç©ºæŒ‡é’ˆæ–­è¨€

### æµ‹è¯•æ§åˆ¶å®
- `TEST_START(test_name)` - å¼€å§‹æµ‹è¯•
- `TEST_END()` - ç»“æŸæµ‹è¯•
- `TEST_SKIP(message)` - è·³è¿‡æµ‹è¯•

### é¢œè‰²è¾“å‡º
æµ‹è¯•æ¡†æ¶æ”¯æŒå½©è‰²è¾“å‡ºï¼Œä½¿æµ‹è¯•ç»“æœæ›´æ˜“è¯»ï¼š
- ğŸ§ª è“è‰²ï¼šæµ‹è¯•å¼€å§‹
- âœ… ç»¿è‰²ï¼šæµ‹è¯•é€šè¿‡
- âŒ çº¢è‰²ï¼šæµ‹è¯•å¤±è´¥
- â­ï¸ é»„è‰²ï¼šæµ‹è¯•è·³è¿‡
- ğŸ‰ ç»¿è‰²ï¼šæ‰€æœ‰æµ‹è¯•é€šè¿‡
- ğŸ’¥ çº¢è‰²ï¼šæœ‰æµ‹è¯•å¤±è´¥

## æµ‹è¯•æ–‡ä»¶ç»“æ„

```
test/ut/
â”œâ”€â”€ test_framework.h          # æµ‹è¯•æ¡†æ¶å¤´æ–‡ä»¶
â”œâ”€â”€ test_framework.c          # æµ‹è¯•æ¡†æ¶å®ç°
â”œâ”€â”€ test_ccvfs_core.c         # æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_compression.c        # å‹ç¼©åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ test_batch_writer.c       # æ‰¹é‡å†™å…¥å™¨æµ‹è¯•
â”œâ”€â”€ test_integration.c        # é›†æˆæµ‹è¯•
â”œâ”€â”€ main.c                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ CMakeLists.txt           # CMake é…ç½®
â””â”€â”€ README.md                # æœ¬æ–‡æ¡£
```

## æµ‹è¯•æ•°æ®ç®¡ç†

æµ‹è¯•æ¡†æ¶è‡ªåŠ¨ç®¡ç†æµ‹è¯•æ–‡ä»¶ï¼š
- æ¯ä¸ªæµ‹è¯•å¥—ä»¶æœ‰ç‹¬ç«‹çš„ setup/teardown å‡½æ•°
- è‡ªåŠ¨æ¸…ç†ä¸´æ—¶æµ‹è¯•æ–‡ä»¶
- é¿å…æµ‹è¯•é—´çš„ç›¸äº’å½±å“

## æ€§èƒ½æµ‹è¯•

é›†æˆæµ‹è¯•åŒ…å«æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼š
- å‹ç¼©/è§£å‹ç¼©æ€§èƒ½
- æ‰¹é‡å†™å…¥æ€§èƒ½
- æ··åˆæ“ä½œæ€§èƒ½
- è´Ÿè½½æµ‹è¯•

## é”™è¯¯å¤„ç†æµ‹è¯•

å…¨é¢çš„é”™è¯¯å¤„ç†æµ‹è¯•ï¼š
- æ— æ•ˆå‚æ•°å¤„ç†
- æ–‡ä»¶ç³»ç»Ÿé”™è¯¯
- å†…å­˜ä¸è¶³æƒ…å†µ
- æ•°æ®æŸåæ¢å¤

## æ‰©å±•æµ‹è¯•

è¦æ·»åŠ æ–°çš„æµ‹è¯•ï¼š

1. åœ¨ç›¸åº”çš„æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•å‡½æ•°
2. ä½¿ç”¨ `REGISTER_TEST_CASE` æ³¨å†Œæµ‹è¯•
3. é‡æ–°æ„å»ºå¹¶è¿è¡Œæµ‹è¯•

ç¤ºä¾‹ï¼š
```c
int test_new_feature(void) {
    TEST_START("New Feature Test");
    
    // æµ‹è¯•ä»£ç 
    TEST_ASSERT(condition, "Feature works correctly");
    
    TEST_END();
    return 1;
}

// åœ¨æ³¨å†Œå‡½æ•°ä¸­æ·»åŠ 
REGISTER_TEST_CASE("CCVFS_Core", "New Feature Test", test_new_feature);
```

## æŒç»­é›†æˆ

æµ‹è¯•å¥—ä»¶è®¾è®¡ç”¨äºæŒç»­é›†æˆç¯å¢ƒï¼š
- è¿”å›é€‚å½“çš„é€€å‡ºä»£ç 
- æ”¯æŒè¶…æ—¶è®¾ç½®
- ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
- æ”¯æŒå¹¶è¡Œæµ‹è¯•æ‰§è¡Œ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘é”™è¯¯**ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–åº“å·²å®‰è£…
2. **æµ‹è¯•å¤±è´¥**ï¼šæ£€æŸ¥æ–‡ä»¶æƒé™å’Œç£ç›˜ç©ºé—´
3. **æ€§èƒ½æµ‹è¯•ä¸ç¨³å®š**ï¼šåœ¨ä¸“ç”¨æµ‹è¯•ç¯å¢ƒä¸­è¿è¡Œ

### è°ƒè¯•æµ‹è¯•

```bash
# ä½¿ç”¨ gdb è°ƒè¯•
gdb ./test/ut/unit_tests
(gdb) run CCVFS_Core

# ä½¿ç”¨ valgrind æ£€æŸ¥å†…å­˜æ³„æ¼
valgrind --leak-check=full ./test/ut/unit_tests
```

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®æ–°çš„æµ‹è¯•ç”¨ä¾‹å’Œæ”¹è¿›ï¼š
1. éµå¾ªç°æœ‰çš„æµ‹è¯•æ¨¡å¼
2. æ·»åŠ é€‚å½“çš„æ–‡æ¡£
3. ç¡®ä¿æµ‹è¯•çš„ç‹¬ç«‹æ€§
4. åŒ…å«é”™è¯¯å¤„ç†æµ‹è¯•